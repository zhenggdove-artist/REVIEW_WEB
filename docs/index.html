
<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RE:VIEW Taiwan - é‡æ–°è§€çœ‹è¡Œå‹•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @font-face {
        font-family: 'ChenYuluoyan';
        src: url('https://cdn.jsdelivr.net/gh/chenyuluoyan/chenyuluoyan@v1.0/fonts/ChenYuluoyan-Thin-v1.0.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }

      * {
        font-family: 'ChenYuluoyan', cursive !important;
        -webkit-font-smoothing: antialiased;
      }

      body {
        background-color: #fcfcfc;
        background-image: url('https://www.transparenttextures.com/patterns/handmade-paper.png');
        color: #1a1a1a;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }

      .sketch-border {
        border: 2px solid #1a1a1a;
        border-radius: 255px 15px 225px 15px/15px 225px 15px 255px;
      }

      .sketch-shadow {
        box-shadow: 6px 6px 0px 0px rgba(0,0,0,0.8);
      }

      .wix-active-box {
        outline: 2px solid #00a1ff !important;
        outline-offset: 4px;
        box-shadow: 0 0 0 9999px rgba(0, 161, 255, 0.05);
      }

      .settings-sidebar {
        width: 350px;
        background: #fff;
        border-left: 3px solid #000;
        height: 100vh;
        position: fixed;
        right: 0;
        top: 0;
        z-index: 2000;
        box-shadow: -10px 0 30px rgba(0,0,0,0.15);
        display: flex;
        flex-direction: column;
        animation: sidebarIn 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      }

      @keyframes sidebarIn {
        from { transform: translateX(100%); }
        to { transform: translateX(0); }
      }

      .content-area {
        transition: margin-right 0.3s ease;
      }

      .admin-mode-active .content-area {
        margin-right: 350px;
      }

      /* éš±è—åŸç”Ÿå·è»¸ */
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-thumb { background: #000; border-radius: 3px; }

      /* æµ®å‹•æ¨™ç±¤æ¨£å¼ */
      .floating-label {
        position: fixed;
        left: 0;
        z-index: 1000;
        padding: 12px 8px;
        border-radius: 0 8px 8px 0;
        box-shadow: 4px 4px 0px rgba(0,0,0,0.3);
        cursor: pointer;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .floating-label:hover {
        transform: scale(1.05);
        box-shadow: 6px 6px 0px rgba(0,0,0,0.4);
      }
      .floating-label.active {
        outline: 3px solid #00a1ff;
        outline-offset: 2px;
      }
      .floating-label-panel {
        position: fixed;
        right: 0;
        top: 0;
        width: 350px;
        height: 100vh;
        background: white;
        border-left: 3px solid #000;
        z-index: 2500;
        box-shadow: -10px 0 30px rgba(0,0,0,0.15);
        overflow-y: auto;
        animation: sidebarIn 0.3s ease;
      }
      .fl-section { padding: 20px; border-bottom: 1px solid #eee; }
      .fl-label { font-size: 12px; font-weight: bold; margin-bottom: 8px; display: block; }
      .fl-input { width: 100%; padding: 10px; border: 2px solid #000; border-radius: 4px; font-size: 14px; }
      .fl-textarea { width: 100%; height: 80px; padding: 10px; border: 2px solid #000; border-radius: 4px; resize: none; }
      .fl-color-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
      .fl-color-input { width: 50px; height: 50px; border: 2px solid #000; padding: 2px; cursor: pointer; }
      .fl-btn-group { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; }
      .fl-btn { padding: 8px; border: 2px solid #000; background: white; font-size: 11px; font-weight: bold; cursor: pointer; }
      .fl-btn.active { background: #FF00A0; color: white; }
      .fl-btn:hover:not(.active) { background: #f0f0f0; }
      .fl-range { width: 100%; accent-color: #FF00A0; }
      .fl-header { padding: 20px; background: #FFF0F5; border-bottom: 2px solid #000; display: flex; justify-content: space-between; align-items: center; }
      .fl-close { width: 36px; height: 36px; border: 2px solid #000; border-radius: 50%; background: white; font-size: 18px; cursor: pointer; }
      .fl-close:hover { background: #000; color: white; }
      .fl-save { width: 100%; padding: 16px; background: #FF00A0; color: white; border: none; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 8px; }
      .fl-save:hover { background: #E0008A; }
      .fl-delete { width: 100%; padding: 12px; background: white; color: #E53E3E; border: 2px solid #E53E3E; font-weight: bold; cursor: pointer; border-radius: 8px; margin-top: 10px; }
      .fl-delete:hover { background: #FFF5F5; }
      .fl-add-btn {
        position: fixed;
        top: 24px;
        left: 180px;
        z-index: 2100;
        background: #FF00A0;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 999px;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 4px 4px 0px rgba(0,0,0,0.3);
        display: none;
      }
      .fl-add-btn:hover { background: #E0008A; }
      .admin-mode-active .fl-add-btn { display: block; }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
        "react/": "https://esm.sh/react@^19.2.3/",
        "react": "https://esm.sh/react@^19.2.3"
      }
    }
    </script>
    <script type="module" crossorigin src="/REVIEW_WEB/assets/index-DJjekY80.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <div id="floating-labels-container"></div>
    <button class="fl-add-btn" id="fl-add-btn">+ æµ®å‹•æ¨™ç±¤</button>
    <div id="floating-label-panel-container"></div>

    <script>
    (function() {
      const STORAGE_KEY = 'floating_labels_v1';
      let labels = [];
      let activeId = null;
      let isAdmin = false;

      // åˆå§‹åŒ–
      function init() {
        loadLabels();
        renderLabels();
        setupAdminObserver();
        document.getElementById('fl-add-btn').addEventListener('click', addLabel);
      }

      // ç›£è½ admin æ¨¡å¼
      function setupAdminObserver() {
        const observer = new MutationObserver(() => {
          const root = document.querySelector('.min-h-screen');
          isAdmin = root && root.classList.contains('admin-mode-active');
          renderLabels();
          if (!isAdmin) closePanel();
        });
        observer.observe(document.body, { childList: true, subtree: true, attributes: true, attributeFilter: ['class'] });

        // å®šæœŸæª¢æŸ¥
        setInterval(() => {
          const root = document.querySelector('.min-h-screen');
          const newAdmin = root && root.classList.contains('admin-mode-active');
          if (newAdmin !== isAdmin) {
            isAdmin = newAdmin;
            renderLabels();
            if (!isAdmin) closePanel();
          }
        }, 500);
      }

      // è®€å–è³‡æ–™
      function loadLabels() {
        try {
          const saved = localStorage.getItem(STORAGE_KEY);
          labels = saved ? JSON.parse(saved) : [
            { id: 'fl-1', content: 'æº«æŸ”è¦–ç·šè¡Œå‹•', color: '#FFFFFF', bgColor: '#FF00A0', fontSize: 'text-sm', top: 30, rotation: 0, vertical: true }
          ];
        } catch(e) { labels = []; }
      }

      // å„²å­˜è³‡æ–™
      function saveLabels() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(labels));
      }

      // æ–°å¢æ¨™ç±¤
      function addLabel() {
        const newLabel = {
          id: 'fl-' + Date.now(),
          content: 'æ–°æ¨™ç±¤',
          color: '#FFFFFF',
          bgColor: '#FF00A0',
          fontSize: 'text-sm',
          top: 50,
          rotation: 0,
          vertical: true
        };
        labels.push(newLabel);
        saveLabels();
        renderLabels();
        openPanel(newLabel.id);
      }

      // åˆªé™¤æ¨™ç±¤
      function deleteLabel(id) {
        if (!confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æµ®å‹•æ¨™ç±¤å—ï¼Ÿ')) return;
        labels = labels.filter(l => l.id !== id);
        saveLabels();
        closePanel();
        renderLabels();
      }

      // æ¸²æŸ“æ‰€æœ‰æ¨™ç±¤
      function renderLabels() {
        const container = document.getElementById('floating-labels-container');
        container.innerHTML = labels.map(label => {
          const fontClass = label.fontSize || 'text-sm';
          return `
            <div class="floating-label ${activeId === label.id ? 'active' : ''}"
                 data-id="${label.id}"
                 style="
                   top: ${label.top}%;
                   background-color: ${label.bgColor};
                   color: ${label.color};
                   transform: rotate(${label.rotation}deg);
                   writing-mode: ${label.vertical ? 'vertical-rl' : 'horizontal-tb'};
                 ">
              <span class="${fontClass}">${label.content}</span>
            </div>
          `;
        }).join('');

        // ç¶å®šé»æ“Šäº‹ä»¶
        container.querySelectorAll('.floating-label').forEach(el => {
          el.addEventListener('click', () => {
            if (isAdmin) openPanel(el.dataset.id);
          });
        });
      }

      // æ‰“é–‹ç·¨è¼¯é¢æ¿
      function openPanel(id) {
        activeId = id;
        const label = labels.find(l => l.id === id);
        if (!label) return;

        renderLabels();

        const fontSizes = [
          { label: 'å°', value: 'text-xs' },
          { label: 'ä¸­', value: 'text-sm' },
          { label: 'å¤§', value: 'text-base' },
          { label: 'ç‰¹å¤§', value: 'text-lg' },
          { label: 'æ¨™é¡Œ', value: 'text-xl' },
          { label: 'éœ‡æ’¼', value: 'text-2xl' }
        ];

        document.getElementById('floating-label-panel-container').innerHTML = `
          <div class="floating-label-panel">
            <div class="fl-header">
              <div>
                <div style="font-size: 18px; font-weight: bold;">æµ®å‹•æ¨™ç±¤è¨­å®š</div>
                <div style="font-size: 10px; color: #FF00A0;">ID: ${label.id}</div>
              </div>
              <button class="fl-close" id="fl-close">âœ•</button>
            </div>

            <div class="fl-section">
              <label class="fl-label">æ¨™ç±¤æ–‡å­—</label>
              <textarea class="fl-textarea" id="fl-content">${label.content}</textarea>
            </div>

            <div class="fl-section">
              <div class="fl-color-row">
                <span class="fl-label" style="margin:0">æ–‡å­—é¡è‰²</span>
                <input type="color" class="fl-color-input" id="fl-color" value="${label.color}">
              </div>
              <div class="fl-color-row">
                <span class="fl-label" style="margin:0">èƒŒæ™¯é¡è‰²</span>
                <input type="color" class="fl-color-input" id="fl-bgColor" value="${label.bgColor}">
              </div>
            </div>

            <div class="fl-section">
              <label class="fl-label">æ–‡å­—å¤§å°</label>
              <div class="fl-btn-group">
                ${fontSizes.map(f => `
                  <button class="fl-btn fl-font-btn ${label.fontSize === f.value ? 'active' : ''}" data-value="${f.value}">${f.label}</button>
                `).join('')}
              </div>
            </div>

            <div class="fl-section">
              <label class="fl-label">æ–‡å­—æ–¹å‘</label>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                <button class="fl-btn fl-dir-btn ${label.vertical ? 'active' : ''}" data-vertical="true">â†• ç›´æ›¸</button>
                <button class="fl-btn fl-dir-btn ${!label.vertical ? 'active' : ''}" data-vertical="false">â†” æ©«æ›¸</button>
              </div>
            </div>

            <div class="fl-section" style="background: #FFF0F5;">
              <label class="fl-label">ğŸ“ ä½ç½®èª¿æ•´</label>
              <div style="margin-bottom: 16px;">
                <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px;">
                  <span>å‚ç›´ä½ç½®</span><span id="fl-top-val">${label.top}%</span>
                </div>
                <input type="range" class="fl-range" id="fl-top" min="5" max="95" value="${label.top}">
              </div>
              <div>
                <div style="display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px;">
                  <span>æ—‹è½‰è§’åº¦</span><span id="fl-rotation-val">${label.rotation}Â°</span>
                </div>
                <input type="range" class="fl-range" id="fl-rotation" min="-45" max="45" value="${label.rotation}">
              </div>
            </div>

            <div class="fl-section">
              <button class="fl-save" id="fl-save">å®Œæˆä¸¦å„²å­˜</button>
              <button class="fl-delete" id="fl-delete">ğŸ—‘ åˆªé™¤æ­¤æ¨™ç±¤</button>
            </div>
          </div>
        `;

        // ç¶å®šäº‹ä»¶
        document.getElementById('fl-close').addEventListener('click', closePanel);
        document.getElementById('fl-save').addEventListener('click', closePanel);
        document.getElementById('fl-delete').addEventListener('click', () => deleteLabel(id));

        document.getElementById('fl-content').addEventListener('input', e => {
          label.content = e.target.value;
          saveLabels();
          renderLabels();
        });

        document.getElementById('fl-color').addEventListener('input', e => {
          label.color = e.target.value;
          saveLabels();
          renderLabels();
        });

        document.getElementById('fl-bgColor').addEventListener('input', e => {
          label.bgColor = e.target.value;
          saveLabels();
          renderLabels();
        });

        document.querySelectorAll('.fl-font-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            label.fontSize = btn.dataset.value;
            saveLabels();
            openPanel(id);
          });
        });

        document.querySelectorAll('.fl-dir-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            label.vertical = btn.dataset.vertical === 'true';
            saveLabels();
            openPanel(id);
          });
        });

        document.getElementById('fl-top').addEventListener('input', e => {
          label.top = parseInt(e.target.value);
          document.getElementById('fl-top-val').textContent = label.top + '%';
          saveLabels();
          renderLabels();
        });

        document.getElementById('fl-rotation').addEventListener('input', e => {
          label.rotation = parseInt(e.target.value);
          document.getElementById('fl-rotation-val').textContent = label.rotation + 'Â°';
          saveLabels();
          renderLabels();
        });
      }

      // é—œé–‰é¢æ¿
      function closePanel() {
        activeId = null;
        document.getElementById('floating-label-panel-container').innerHTML = '';
        renderLabels();
      }

      // å•Ÿå‹•
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }
    })();
    </script>
</body>
</html>
